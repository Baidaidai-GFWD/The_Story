# 搭建节点心德
## 前景提要：
本作者为一名高中生，并无系统学习过计算机网络以及网安方面的知识，若有欠缺，欢迎指教！
- 由于厦门市海沧区某学校建立了校园网的防护机制，没有`教师认证`的WI-FI登陆账号即为无法登陆校园网，故本作者萌生了一个念头，是否可以采用和跨越GFW的方法类似，通过加密流量欺骗学校的代理服务器实现无需`教师认证`即可尝试访问校园网
- 本文将有大量的，充满技术向的issue和操作步骤，若您不会，请勿轻易尝试！
- 能有本文，由衷地感谢YouTube主“不良林”，Anthropic公司的Claude，OpenAi公司的Chat—GPT！

## 心路历程
我先尝试了搭建了shadowsocks加密节点，<del>这个个节点会在下文简称为ss节点</del>。


由于本人当初欠缺互联网网络基础知识，故一开始遇到了十分棘手的问题：什么是DNZ主机，DNS解析器是怎么工作的，IP又是怎么帮我们确定位置的？

当然，感谢"[YouTube博主不良林](https://www.youtube.com/@bulianglin)"的视频简介，让我了解到了整个互联网的运作原理。


了解了这些原理之后，我就开始了搭建我人生中第一个ss节点（一开始用的是shadowsocks-libev），刚开始一切顺利，但当我将我的节点IP（因为之前图省事，直接先用了局域网IP进行搭建，成功了后会换成域名）更改成域名后，发现了一个致命的错误：ss-libev无法识别我域名的IPv6地址，就算是直接输入IPv6地址都无济于事。

而当我再去GitHub社区的ss项目逛时，发现它们其中有一个项目"[shadowsocks- rust](https://github.com/shadowsocks/shadowsocks-rust)"不仅原生支持了Mac电脑的"[homebrew](https://gitee.com/wejectchan/brew)"包管理器，而且支持了IPv6和IPv4双栈协议，大大简化了我后续的操作
## 尝试搭建
首先，我先去了"[阿里云DNS](https://wanwang.aliyun.com/?spm=5176.28261954.J_7341193060.2.38432f3dvTfxnE&scm=20140722.S_card@@商品@@212429.S_card0.ID_card@@商品@@212429-RL_域名-LOC_search~UND~card~UND~item-OR_ser-V_3-P0_0)"购买了一个域名，方便我后期使用，当绑定了域名后的8小时，是我最开心也是最得意的8小时······

当8小时过去了，我发现我的节点死活ping不通，ss节点也没有报错，最后查了一下，居然是一个叫做DHCP的东西将我的IP地址夺走了，使我的域名无法解析到我的电脑上。

经过我上B站冲浪了一番，发现这个[视频](https://b23.tv/ppeJMHG)，受这个博主的启发，我在我的Mac上开始部署起了DDNS服务，虽然有点难，但好在有官方的教程和参考范例，部署起DDNS还是相对简单的。👉🏻[项目地址](https://github.com/NewFuture/DDNS) 
## 享受成果
之后的时间，我度过了快乐的暑假，去了新疆游历了一番，并顺带测试了节点是否可以正常访问。当然，如我所愿，只要有信号的地方，都能使用移动数据连接我自己的节点（因为现在国内的IPv6覆盖率太低了，基本都是用IPv4来通信的）。

并且我在我的Mac电脑上部署了多项需要公网访问的服务（现由于不需要已经关闭了）,比如smb文件访问、vnc远程桌面、ssh远程连接均能通过节点连接后正常使用

## 心有余，力不足
两个月的时间飞逝，当我再次回到学校时，发现学校的网络居然ping不通我家的节点（前提：我家离学校100m左右）,使我产生了深深的疑惑，之后的时间里我趁老师登录的功夫，访问了我部署的vnc服务，发现也不行，于是我登录了"[IPv6测试网站](https://test-ipv6.com)"测试学校的IPv6是否能正常使用，不出所料，无法访问···

于是我就没打算再弄这个节点了·······

我在这里说明一下我为什么不想再弄的原因，主要有两点：
1. 现在IPv4的IP十分难获得，我不清楚我去尝试是否能获得，就算能获得，估计要加钱
2. 如果我真的想要拥有一个IPv4节点的话，我可以选择购买一个云服务器，但是购买一台云服务器流量费和月租成本较高，我认为性价比不大

后来的几个月里，我上YouTube冲浪的时候看到了一番不良林的[这期视频](https://www.youtube.com/watch?v=dGYNinKfUR4&t=1s)。里面详细讲解了停机免流的原理。其中有一点我很感兴趣，就是vmess居然能将所有非正常流量伪装成普通的http请求流量，于是我着手开始搭建了一个vmess节点···
## 再出山
有了之前的ss节点搭建经验，这次的vmess搭建异常顺利，顺利地启动了起来。但是伪装流量的情况是这样的：客户端配置了，但是服务端解析不了一直是家常便饭。
原本我一直以为是配置文件的这块识别的：

        "sniffing": {
        "enabled": true,
        "destOverride": [
            "http",
            "tls",
            "quic"
        ],
        "metadataOnly": false
直到Claude提醒我这是识别流量特征，而嗅探伪装是要添加解析模块才可以，我这才恍然大悟

        "streamSettings": {
        "network": "tcp",
        "security": "none",
        "tcpSettings": {
          "header": {
            "type": "http",
            "request": {
              "version": "1.1",
              "method": "GET",
              "path": ["/"],
              "headers": {
                "Host": ["*"]
              }
            }
          }
        }
        }
于是再也没有出现上述情况了。

然而，好像一切又回到了原点，我没有IPv4！抱着试一试的态度，我打通了10000号尝试了起来。没想到工作人员想都没想直接同意了我的请求，火速将我的公网IPv4部署上去了

## bug堆
由于当时我第一次尝试部署的时候已是上半年，大家也知道，每过几周，互联网上基本上很多东西都会发生变化，DDNS的代码也是。所以当我使用5月份的DDNS的代码运行起来时，它爆了一堆错。

我火速去GitHub上又重新下载了最新的源码，当然还是产生了其他的报错。我一看，为什么获取不到`public字号`的IPv4公网IP呢。

我到了10月18号才知道，原来现在的新的Mac电脑（tips：我在8月份换了一台新的Mac电脑，m1Max，因为旧的Mac电脑太卡了2015）Wi-Fi芯片是bcm的，和我路由器的mtk芯片兼容性并不好，时常会产生重置（最严重的情况是测速都测不了一次）

于是我接上了我的拓展坞，禁用了Wi-Fi，使用有线连接（结果比🐶都稳，看YouTube4k都不带卡的）

解决完了DDNS的问题后，我尝试开始部署vmess节点，刚开始将域名填入json里的时候，服务端一直启动不了，说：

        Failed to start: main/commands: failed to load config: [/Users/xxxxxxx/Desktop/服务器/V2ray/Vmess/Vmess.json] > infra/conf/v4: unable to listen on domain address: xxxx.xxxx.xxx
后来询问了Claude才知道，这个只能填写IP地址，并且它推荐我填入0.0.0.0这样所有传入连接都会被允许

至此，我的配置之旅结束
      
